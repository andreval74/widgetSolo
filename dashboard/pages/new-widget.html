<!-- New Widget Creation Page -->
<div class="row">
    <div class="col-lg-8">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-plus-circle me-2 text-primary"></i>
                        Criar Novo Widget
                    </h5>
                    <div>
                        <button type="button" class="btn btn-outline-secondary me-2" onclick="loadSection('overview'); updateActiveMenu('overview');">
                            <i class="fas fa-arrow-left me-1"></i>Voltar
                        </button>
                        <button type="button" class="btn btn-outline-primary" onclick="clearWidgetForm();">
                            <i class="fas fa-refresh me-1"></i>Limpar
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body p-4">
                <form id="widget-form" onsubmit="createNewWidget(event)">
                    <!-- Informações Básicas -->
                    <div class="mb-4">
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-info-circle me-2"></i>Informações Básicas
                        </h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="widget-name" class="form-label">Nome do Widget *</label>
                                <input type="text" class="form-control" id="widget-name" placeholder="Ex: Venda de Token XYZ" required oninput="updateWidgetPreview()">
                                <div class="form-text">Nome que aparecerá no widget</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="token-symbol" class="form-label">Símbolo do Token *</label>
                                <input type="text" class="form-control" id="token-symbol" placeholder="Ex: XYZ" required oninput="updateWidgetPreview()">
                                <div class="form-text">Símbolo único do seu token</div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="widget-description" class="form-label">Descrição</label>
                            <textarea class="form-control" id="widget-description" rows="3" placeholder="Descrição do seu token e projeto..." oninput="updateWidgetPreview()"></textarea>
                            <div class="form-text">Descrição detalhada que aparecerá no widget</div>
                        </div>
                    </div>

                    <!-- Configurações de Preço -->
                    <div class="mb-4">
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-dollar-sign me-2"></i>Configurações de Preço
                        </h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="token-price" class="form-label">Preço por Token (BNB) *</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="token-price" step="0.0001" placeholder="0.001" required oninput="updateWidgetPreview()">
                                    <span class="input-group-text">BNB</span>
                                </div>
                                <div class="form-text">Preço em BNB por token</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="min-purchase" class="form-label">Compra Mínima</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="min-purchase" placeholder="1" min="1">
                                    <span class="input-group-text">tokens</span>
                                </div>
                                <div class="form-text">Quantidade mínima por compra</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="total-supply" class="form-label">Total de Tokens Disponíveis *</label>
                                <input type="number" class="form-control" id="total-supply" placeholder="1000000" required oninput="updateWidgetPreview()">
                                <div class="form-text">Quantidade total para venda</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="max-purchase" class="form-label">Compra Máxima</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="max-purchase" placeholder="10000">
                                    <span class="input-group-text">tokens</span>
                                </div>
                                <div class="form-text">Quantidade máxima por compra</div>
                            </div>
                        </div>
                    </div>

                    <!-- Configurações Visuais -->
                    <div class="mb-4">
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-palette me-2"></i>Aparência do Widget
                        </h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="widget-color" class="form-label">Cor Principal</label>
                                <input type="color" class="form-control form-control-color" id="widget-color" value="#667eea" onchange="updateWidgetPreview()">
                                <div class="form-text">Cor que dominará o design do widget</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="widget-style" class="form-label">Estilo</label>
                                <select class="form-select" id="widget-style" onchange="updateWidgetPreview()">
                                    <option value="modern">Moderno</option>
                                    <option value="classic">Clássico</option>
                                    <option value="minimal">Minimalista</option>
                                    <option value="gradient">Gradiente</option>
                                </select>
                                <div class="form-text">Estilo visual do widget</div>
                            </div>
                        </div>
                    </div>

                    <!-- Configurações de Rede -->
                    <div class="mb-4">
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-network-wired me-2"></i>Configurações Blockchain
                        </h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="blockchain-network" class="form-label">Rede Blockchain *</label>
                                <select class="form-select" id="blockchain-network" required>
                                    <option value="">Selecionar rede...</option>
                                    <option value="56">Binance Smart Chain (BSC)</option>
                                    <option value="1">Ethereum Mainnet</option>
                                    <option value="137">Polygon (MATIC)</option>
                                    <option value="97">BSC Testnet</option>
                                </select>
                                <div class="form-text">Rede onde o token está implantado</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="token-contract" class="form-label">Endereço do Contrato</label>
                                <input type="text" class="form-control" id="token-contract" placeholder="0x...">
                                <div class="form-text">Endereço do contrato do token (opcional)</div>
                            </div>
                        </div>
                    </div>

                    <!-- Botões de Ação -->
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4 pt-3 border-top">
                        <button type="button" class="btn btn-outline-secondary me-md-2" onclick="loadSection('overview'); updateActiveMenu('overview');">
                            <i class="fas fa-times me-1"></i>Cancelar
                        </button>
                        <button type="button" class="btn btn-outline-primary me-md-2" onclick="clearWidgetForm()">
                            <i class="fas fa-refresh me-1"></i>Limpar
                        </button>
                        <button type="button" class="btn btn-primary" onclick="previewNewWidget()">
                            <i class="fas fa-eye me-1"></i>Visualizar
                        </button>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save me-1"></i>Criar Widget
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card border-0 shadow-sm sticky-top" style="top: 20px;">
            <div class="card-header bg-white border-bottom">
                <h6 class="mb-0">
                    <i class="fas fa-eye me-2 text-info"></i>
                    Preview do Widget
                </h6>
            </div>
            <div class="card-body">
                <div id="widget-preview" class="border border-2 border-dashed rounded p-4 text-center">
                    <div class="mb-3">
                        <i class="fas fa-cube fa-3x text-primary mb-3" id="preview-icon"></i>
                        <h5 id="preview-name" class="text-dark">Nome do Widget</h5>
                        <p class="text-muted small" id="preview-description">Descrição aparecerá aqui...</p>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="small">Símbolo:</span>
                            <strong id="preview-symbol" class="small">XYZ</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="small">Preço:</span>
                            <strong id="preview-price" class="small">0.001 BNB</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="small">Disponível:</span>
                            <strong id="preview-supply" class="small">1,000,000</strong>
                        </div>
                    </div>
                    <button class="btn btn-primary w-100" disabled id="preview-button">
                        <i class="fas fa-shopping-cart me-1"></i>
                        Comprar Tokens
                    </button>
                    <div class="mt-3">
                        <small class="text-muted">
                            <i class="fas fa-shield-alt me-1"></i>
                            Seguro & Verificado
                        </small>
                    </div>
                </div>
                
                <!-- Informações da Pre-visualização -->
                <div class="mt-3">
                    <h6 class="text-primary">
                        <i class="fas fa-info-circle me-2"></i>Informações
                    </h6>
                    <div class="small text-muted">
                        <div class="d-flex justify-content-between mb-1">
                            <span>Custo de criação:</span>
                            <strong class="text-warning">10 créditos</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-1">
                            <span>Taxa por venda:</span>
                            <strong class="text-info">2%</strong>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Você recebe:</span>
                            <strong class="text-success">98%</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function updateWidgetPreview() {
    var nameEl = document.getElementById('widget-name');
    var symbolEl = document.getElementById('token-symbol');
    var descEl = document.getElementById('widget-description');
    var priceEl = document.getElementById('token-price');
    var supplyEl = document.getElementById('total-supply');
    var colorEl = document.getElementById('widget-color');
    var styleEl = document.getElementById('widget-style');
    
    if (nameEl && document.getElementById('preview-name')) {
        document.getElementById('preview-name').textContent = nameEl.value || 'Nome do Widget';
    }
    
    if (symbolEl && document.getElementById('preview-symbol')) {
        document.getElementById('preview-symbol').textContent = symbolEl.value || 'XYZ';
    }
    
    if (descEl && document.getElementById('preview-description')) {
        document.getElementById('preview-description').textContent = descEl.value || 'Descrição aparecerá aqui...';
    }
    
    if (priceEl && document.getElementById('preview-price')) {
        document.getElementById('preview-price').textContent = (priceEl.value || '0.001') + ' BNB';
    }
    
    if (supplyEl && document.getElementById('preview-supply')) {
        var supply = supplyEl.value || '1000000';
        document.getElementById('preview-supply').textContent = Number(supply).toLocaleString();
    }
    
    if (colorEl && document.getElementById('preview-button')) {
        document.getElementById('preview-button').style.backgroundColor = colorEl.value;
        document.getElementById('preview-button').style.borderColor = colorEl.value;
    }
    
    if (styleEl && document.getElementById('preview-icon')) {
        var icons = {
            'modern': 'fas fa-cube',
            'classic': 'fas fa-coins',
            'minimal': 'fas fa-circle',
            'gradient': 'fas fa-gem'
        };
        var iconClass = icons[styleEl.value] || 'fas fa-cube';
        document.getElementById('preview-icon').className = iconClass + ' fa-3x text-primary mb-3';
    }
}

function previewNewWidget() {
    var name = document.getElementById('widget-name').value;
    var symbol = document.getElementById('token-symbol').value;
    var price = document.getElementById('token-price').value;
    
    if (!name || !symbol || !price) {
        alert('Por favor, preencha os campos obrigatórios (Nome, Símbolo e Preço)');
        return;
    }
    
    alert('Preview completo: ' + name + ' (' + symbol + ') - ' + price + ' BNB');
}

function createNewWidget(event) {
    event.preventDefault();
    
    var requiredFields = [
        {el: document.getElementById('widget-name'), name: 'Nome do Widget'},
        {el: document.getElementById('token-symbol'), name: 'Símbolo do Token'},
        {el: document.getElementById('token-price'), name: 'Preço do Token'},
        {el: document.getElementById('total-supply'), name: 'Total de Tokens'},
        {el: document.getElementById('blockchain-network'), name: 'Rede Blockchain'}
    ];
    
    for (var i = 0; i < requiredFields.length; i++) {
        if (!requiredFields[i].el || !requiredFields[i].el.value.trim()) {
            alert('Campo obrigatório: ' + requiredFields[i].name);
            if (requiredFields[i].el) requiredFields[i].el.focus();
            return;
        }
    }
    
    var widgetData = {
        id: 'widget_' + Date.now(),
        name: document.getElementById('widget-name').value,
        symbol: document.getElementById('token-symbol').value,
        description: document.getElementById('widget-description').value,
        price: parseFloat(document.getElementById('token-price').value),
        minPurchase: parseInt(document.getElementById('min-purchase').value) || 1,
        maxPurchase: parseInt(document.getElementById('max-purchase').value) || null,
        totalSupply: parseInt(document.getElementById('total-supply').value),
        color: document.getElementById('widget-color').value,
        style: document.getElementById('widget-style').value,
        network: document.getElementById('blockchain-network').value,
        contract: document.getElementById('token-contract').value,
        createdAt: new Date().toISOString(),
        status: 'active',
        sold: 0,
        revenue: 0
    };
    
    var widgets = JSON.parse(localStorage.getItem('widgets') || '[]');
    widgets.push(widgetData);
    localStorage.setItem('widgets', JSON.stringify(widgets));
    
    var alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-success alert-dismissible fade show position-fixed';
    alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999;';
    alertDiv.innerHTML = '<i class="fas fa-check-circle me-2"></i>Widget "' + widgetData.name + '" criado com sucesso! <button type="button" class="btn-close" data-bs-dismiss="alert"></button>';
    document.body.appendChild(alertDiv);
    
    setTimeout(function() {
        alertDiv.remove();
        loadSection('widgets');
        updateActiveMenu('widgets');
    }, 2000);
}

function clearWidgetForm() {
    if (confirm('Tem certeza que deseja limpar todos os campos?')) {
        document.getElementById('widget-form').reset();
        setTimeout(function() {
            updateWidgetPreview();
        }, 100);
    }
}

// Inicializar preview quando a página carrega
setTimeout(function() {
    updateWidgetPreview();
}, 500);
</script>