<div class="row">
    <div class="col-lg-8">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-plus-circle me-2 text-primary"></i>
                        Criar Novo Widget
                    </h5>
                    <div>
                        <button type="button" class="btn btn-outline-secondary me-2" onclick="loadSection('overview'); updateActiveMenu('overview');">
                            <i class="fas fa-arrow-left me-1"></i>Voltar
                        </button>
                        <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('widget-form').reset(); updatePreview();">
                            <i class="fas fa-refresh me-1"></i>Limpar
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body p-4">
                <form id="widget-form">
                    <!-- Informa√ß√µes B√°sicas -->
                    <div class="mb-4">
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-info-circle me-2"></i>Informa√ß√µes B√°sicas
                        </h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="widget-name" class="form-label">Nome do Widget *</label>
                                <input type="text" class="form-control" id="widget-name" placeholder="Ex: Venda de Token XYZ" required>
                                <div class="form-text">Nome que aparecer√° no widget</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="token-symbol" class="form-label">S√≠mbolo do Token *</label>
                                <input type="text" class="form-control" id="token-symbol" placeholder="Ex: XYZ" required>
                                <div class="form-text">S√≠mbolo √∫nico do seu token</div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="widget-description" class="form-label">Descri√ß√£o</label>
                            <textarea class="form-control" id="widget-description" rows="3" placeholder="Descri√ß√£o do seu token e projeto..."></textarea>
                            <div class="form-text">Descri√ß√£o detalhada que aparecer√° no widget</div>
                        </div>
                    </div>

                    <!-- Configura√ß√µes de Pre√ßo -->
                    <div class="mb-4">
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-dollar-sign me-2"></i>Configura√ß√µes de Pre√ßo
                        </h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="token-price" class="form-label">Pre√ßo por Token (BNB) *</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="token-price" step="0.0001" placeholder="0.001" required>
                                    <span class="input-group-text">BNB</span>
                                </div>
                                <div class="form-text">Pre√ßo em BNB por token</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="min-purchase" class="form-label">Compra M√≠nima</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="min-purchase" placeholder="1" min="1">
                                    <span class="input-group-text">tokens</span>
                                </div>
                                <div class="form-text">Quantidade m√≠nima por compra</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="total-supply" class="form-label">Total de Tokens Dispon√≠veis *</label>
                                <input type="number" class="form-control" id="total-supply" placeholder="1000000" required>
                                <div class="form-text">Quantidade total para venda</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="max-purchase" class="form-label">Compra M√°xima</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="max-purchase" placeholder="10000">
                                    <span class="input-group-text">tokens</span>
                                </div>
                                <div class="form-text">Quantidade m√°xima por compra</div>
                            </div>
                        </div>
                    </div>

                    <!-- Configura√ß√µes Visuais -->
                    <div class="mb-4">
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-palette me-2"></i>Apar√™ncia do Widget
                        </h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="widget-color" class="form-label">Cor Principal</label>
                                <input type="color" class="form-control form-control-color" id="widget-color" value="#667eea">
                                <div class="form-text">Cor que dominar√° o design do widget</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="widget-style" class="form-label">Estilo</label>
                                <select class="form-select" id="widget-style">
                                    <option value="modern">Moderno</option>
                                    <option value="classic">Cl√°ssico</option>
                                    <option value="minimal">Minimalista</option>
                                    <option value="gradient">Gradiente</option>
                                </select>
                                <div class="form-text">Estilo visual do widget</div>
                            </div>
                        </div>
                    </div>

                    <!-- Configura√ß√µes de Rede -->
                    <div class="mb-4">
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-network-wired me-2"></i>Configura√ß√µes Blockchain
                        </h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="blockchain-network" class="form-label">Rede Blockchain *</label>
                                <select class="form-select" id="blockchain-network" required>
                                    <option value="">Selecionar rede...</option>
                                    <option value="56">Binance Smart Chain (BSC)</option>
                                    <option value="1">Ethereum Mainnet</option>
                                    <option value="137">Polygon (MATIC)</option>
                                    <option value="97">BSC Testnet</option>
                                </select>
                                <div class="form-text">Rede onde o token est√° implantado</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="token-contract" class="form-label">Endere√ßo do Contrato</label>
                                <input type="text" class="form-control" id="token-contract" placeholder="0x...">
                                <div class="form-text">Endere√ßo do contrato do token (opcional)</div>
                            </div>
                        </div>
                    </div>

                    <!-- Bot√µes de A√ß√£o -->
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4 pt-3 border-top">
                        <button type="button" class="btn btn-outline-secondary me-md-2" onclick="loadSection('overview'); updateActiveMenu('overview');">
                            <i class="fas fa-times me-1"></i>Cancelar
                        </button>
                        <button type="button" class="btn btn-primary" onclick="previewWidget()">
                            <i class="fas fa-eye me-1"></i>Visualizar
                        </button>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save me-1"></i>Criar Widget
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card border-0 shadow-sm sticky-top" style="top: 20px;">
            <div class="card-header bg-white border-bottom">
                <h6 class="mb-0">
                    <i class="fas fa-eye me-2 text-info"></i>
                    Preview do Widget
                </h6>
            </div>
            <div class="card-body">
                <div id="widget-preview" class="border border-2 border-dashed rounded p-4 text-center">
                    <div class="mb-3">
                        <i class="fas fa-cube fa-3x text-primary mb-3" id="preview-icon"></i>
                        <h5 id="preview-name" class="text-dark">Nome do Widget</h5>
                        <p class="text-muted small" id="preview-description">Descri√ß√£o aparecer√° aqui...</p>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="small">S√≠mbolo:</span>
                            <strong id="preview-symbol" class="small">XYZ</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="small">Pre√ßo:</span>
                            <strong id="preview-price" class="small">0.001 BNB</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="small">Dispon√≠vel:</span>
                            <strong id="preview-supply" class="small">1,000,000</strong>
                        </div>
                    </div>
                    <button class="btn btn-primary w-100" disabled>
                        <i class="fas fa-shopping-cart me-1"></i>
                        Comprar Tokens
                    </button>
                    <div class="mt-3">
                        <small class="text-muted">
                            <i class="fas fa-shield-alt me-1"></i>
                            Seguro & Verificado
                        </small>
                    </div>
                </div>
                
                <!-- Informa√ß√µes da Pre-visualiza√ß√£o -->
                <div class="mt-3">
                    <h6 class="text-primary">
                        <i class="fas fa-info-circle me-2"></i>Informa√ß√µes
                    </h6>
                    <div class="small text-muted">
                        <div class="d-flex justify-content-between mb-1">
                            <span>Custo de cria√ß√£o:</span>
                            <strong class="text-warning">10 cr√©ditos</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-1">
                            <span>Taxa por venda:</span>
                            <strong class="text-info">2%</strong>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Voc√™ recebe:</span>
                            <strong class="text-success">98%</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-10">
                    <label for="contractAddress" class="form-label">Endere√ßo do Token</label>
                    <input type="text" id="contractAddress" class="form-control" placeholder="0x..." maxlength="42">
                </div>
                <div class="col-md-2">
                    <label class="form-label invisible">Detectar</label>
                    <button type="button" class="btn btn-primary w-100" onclick="detectContract()" id="detectBtn">
                        <i class="fas fa-search"></i> Detectar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Etapa 3: Informa√ß√µes do Token -->
    <div id="tokenInfoSection" class="card mb-4" style="display: none;">
        <div class="card-header bg-success text-white">
            <h6 class="mb-0">
                <span class="badge bg-light text-success me-2">3</span>
                Informa√ß√µes do Token
            </h6>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <label for="tokenName" class="form-label">Nome</label>
                    <input type="text" id="tokenName" class="form-control" readonly>
                </div>
                <div class="col-md-4">
                    <label for="tokenSymbol" class="form-label">S√≠mbolo</label>
                    <input type="text" id="tokenSymbol" class="form-control" readonly>
                </div>
                <div class="col-md-4">
                    <label for="tokenDecimals" class="form-label">Decimais</label>
                    <input type="text" id="tokenDecimals" class="form-control" readonly>
                </div>
            </div>
        </div>
    </div>

    <!-- Etapa 4: Configura√ß√£o do Widget -->
    <div id="widgetConfigSection" class="card mb-4" style="display: none;">
        <div class="card-header bg-info text-white">
            <h6 class="mb-0">
                <span class="badge bg-light text-info me-2">4</span>
                Configurar Widget
            </h6>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <label for="tokenPrice" class="form-label">Pre√ßo por Token (USD)</label>
                    <input type="number" id="tokenPrice" class="form-control" placeholder="0.001" step="0.000001" min="0">
                </div>
                <div class="col-md-6">
                    <label for="totalAmount" class="form-label">Quantidade Total</label>
                    <input type="number" id="totalAmount" class="form-control" placeholder="1000" step="1" min="1">
                </div>
            </div>
            
            <div class="row mt-3">
                <div class="col-md-12">
                    <label for="widgetTitle" class="form-label">T√≠tulo do Widget (opcional)</label>
                    <input type="text" id="widgetTitle" class="form-control" placeholder="Venda de Tokens">
                </div>
            </div>
            
            <div class="mt-4 text-center">
                <button type="button" class="btn btn-success btn-lg" onclick="createWidget()">
                    <i class="fas fa-rocket me-2"></i>Criar Widget
                </button>
            </div>
        </div>
    </div>
</div>

<script>
console.log('üöÄ IN√çCIO DO SCRIPT NEW-WIDGET');

// Vari√°veis globais
let selectedNetwork = null;
console.log('‚úÖ Vari√°vel selectedNetwork inicializada');
let detectedToken = null;

// Configura√ß√£o das redes
const networkConfigs = {
    '1': { 
        name: 'Ethereum Mainnet', 
        currency: 'ETH',
        rpc: ['https://eth.llamarpc.com', 'https://rpc.ankr.com/eth']
    },
    '56': { 
        name: 'BNB Smart Chain', 
        currency: 'BNB',
        rpc: ['https://bsc-dataseed.binance.org/', 'https://bsc-dataseed1.binance.org/']
    },
    '137': { 
        name: 'Polygon', 
        currency: 'MATIC',
        rpc: ['https://polygon-rpc.com', 'https://rpc.ankr.com/polygon']
    },
    '97': { 
        name: 'BSC Testnet', 
        currency: 'tBNB',
        rpc: ['https://data-seed-prebsc-1-s1.binance.org:8545/']
    }
};

// Sele√ß√£o de rede
function selectNetwork() {
    const select = document.getElementById('networkSelect');
    const chainId = select.value;
    
    if (chainId) {
        document.getElementById('chainId').value = chainId;
        
        selectedNetwork = {
            chainId: parseInt(chainId),
            ...networkConfigs[chainId]
        };
        
        console.log('üåê Rede selecionada:', selectedNetwork);
        
        // Reset quando trocar de rede
        hideTokenSections();
        document.getElementById('contractAddress').value = '';
        detectedToken = null;
    }
}

// Fun√ß√£o para detectar dados do token - baseada no xcafe
async function fetchTokenData(tokenAddress, provider) {
    try {
        const abi = [
            "function name() view returns (string)",
            "function symbol() view returns (string)",
            "function decimals() view returns (uint8)",
            "function totalSupply() view returns (uint256)",
            "function owner() view returns (address)"
        ];
        
        const contract = new ethers.Contract(tokenAddress, abi, provider);
        
        const [name, symbol, decimals, totalSupply, owner] = await Promise.all([
            contract.name().catch(() => ""),
            contract.symbol().catch(() => ""),
            contract.decimals().catch(() => 18),
            contract.totalSupply().catch(() => "0"),
            contract.owner().catch(() => "")
        ]);

        return {
            name,
            symbol,
            decimals: decimals.toString(),
            totalSupply: totalSupply.toString(),
            owner,
            address: tokenAddress
        };
    } catch (error) {
        console.error("‚ùå Erro ao buscar dados do token:", error);
        throw error;
    }
}

// Detectar contrato
async function detectContract() {
    console.log('üîç FUN√á√ÉO detectContract CHAMADA');
    
    const address = document.getElementById('contractAddress').value.trim();
    console.log('üìã Endere√ßo:', address);
    
    if (!selectedNetwork) {
        alert('Por favor, selecione uma rede primeiro');
        return;
    }
    
    if (!address || !/^0x[a-fA-F0-9]{40}$/i.test(address)) {
        alert('Endere√ßo inv√°lido. Use o formato: 0x...');
        return;
    }
    
    const detectBtn = document.getElementById('detectBtn');
    detectBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Detectando...';
    detectBtn.disabled = true;
    
    try {
        console.log('üîç Iniciando detec√ß√£o do token:', address);
        console.log('üåê Rede:', selectedNetwork.name);
        
        // Criar provider com RPC da rede selecionada
        const provider = new ethers.providers.JsonRpcProvider(selectedNetwork.rpc[0]);
        
        // Verificar se √© um contrato
        const code = await provider.getCode(address);
        if (code === '0x') {
            throw new Error('Endere√ßo n√£o √© um contrato inteligente');
        }
        
        console.log('‚úÖ Contrato detectado, buscando dados...');
        
        // Buscar dados do token
        const tokenData = await fetchTokenData(address, provider);
        
        if (!tokenData.name || !tokenData.symbol) {
            throw new Error('Contrato n√£o retorna dados de token v√°lidos');
        }
        
        detectedToken = {
            address: address,
            name: tokenData.name,
            symbol: tokenData.symbol,
            decimals: parseInt(tokenData.decimals),
            totalSupply: tokenData.totalSupply,
            owner: tokenData.owner,
            network: selectedNetwork
        };
        
        console.log('üéâ Token detectado com sucesso:', detectedToken);
        
        // Atualizar UI
        document.getElementById('tokenName').value = detectedToken.name;
        document.getElementById('tokenSymbol').value = detectedToken.symbol;
        document.getElementById('tokenDecimals').value = detectedToken.decimals;
        
        // Mostrar se√ß√µes
        document.getElementById('tokenInfoSection').style.display = 'block';
        document.getElementById('widgetConfigSection').style.display = 'block';
        
        // Feedback visual
        detectBtn.innerHTML = '<i class="fas fa-check-circle text-success"></i> Detectado!';
        
        setTimeout(() => {
            detectBtn.innerHTML = '<i class="fas fa-search"></i> Detectar';
            detectBtn.disabled = false;
        }, 2000);
        
    } catch (error) {
        console.error('‚ùå Erro ao detectar token:', error);
        alert('Erro ao detectar token: ' + error.message);
        
        detectBtn.innerHTML = '<i class="fas fa-exclamation-triangle text-danger"></i> Erro';
        setTimeout(() => {
            detectBtn.innerHTML = '<i class="fas fa-search"></i> Detectar';
            detectBtn.disabled = false;
        }, 2000);
    }
}

// Criar widget
async function createWidget() {
    const price = document.getElementById('tokenPrice').value;
    const amount = document.getElementById('totalAmount').value;
    const title = document.getElementById('widgetTitle').value || 'Venda de Tokens';
    
    if (!detectedToken) {
        alert('Por favor, detecte um token primeiro');
        return;
    }
    
    if (!price || parseFloat(price) <= 0) {
        alert('Insira um pre√ßo v√°lido');
        return;
    }
    
    if (!amount || parseInt(amount) <= 0) {
        alert('Insira uma quantidade v√°lida');
        return;
    }
    
    const widgetData = {
        id: 'widget_' + Date.now(),
        network: selectedNetwork,
        token: detectedToken,
        price: parseFloat(price),
        amount: parseInt(amount),
        title: title,
        createdAt: new Date().toISOString(),
        active: true
    };
    
    console.log('üöÄ Criando widget:', widgetData);
    
    try {
        // Aqui seria feita a chamada para a API para salvar o widget
        // Por enquanto, simular sucesso
        
        alert('üéâ Widget criado com sucesso!\n\n' +
              `Token: ${detectedToken.name} (${detectedToken.symbol})\n` +
              `Rede: ${selectedNetwork.name}\n` +
              `Pre√ßo: ${price} ${selectedNetwork.currency}\n` +
              `Quantidade: ${amount} tokens`);
        
        if (typeof dashboardManager !== 'undefined') {
            dashboardManager.showSection('contracts');
        }
        
    } catch (error) {
        console.error('‚ùå Erro ao criar widget:', error);
        alert('Erro ao criar widget: ' + error.message);
    }
}

// Limpar formul√°rio
function resetForm() {
    document.getElementById('networkSelect').value = '';
    document.getElementById('chainId').value = '';
    document.getElementById('contractAddress').value = '';
    document.getElementById('tokenPrice').value = '';
    document.getElementById('totalAmount').value = '';
    document.getElementById('widgetTitle').value = '';
    
    hideTokenSections();
    
    selectedNetwork = null;
    detectedToken = null;
    
    console.log('üßπ Formul√°rio limpo');
}

// Ocultar se√ß√µes de token
function hideTokenSections() {
    document.getElementById('tokenInfoSection').style.display = 'none';
    document.getElementById('widgetConfigSection').style.display = 'none';
}

// Valida√ß√£o em tempo real do endere√ßo
document.addEventListener('DOMContentLoaded', function() {
    const contractInput = document.getElementById('contractAddress');
    
    if (contractInput) {
        contractInput.addEventListener('input', function() {
            const address = this.value.trim();
            const detectBtn = document.getElementById('detectBtn');
            
            if (address.length === 42 && address.startsWith('0x')) {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
                if (detectBtn) detectBtn.disabled = false;
            } else {
                this.classList.remove('is-valid');
                if (address.length > 0) {
                    this.classList.add('is-invalid');
                }
                if (detectBtn) detectBtn.disabled = true;
            }
        });
    }
});

console.log('üìã Sistema de cria√ß√£o de widget carregado');
<script>
// Atualizar preview em tempo real
function updatePreview() {
    const form = document.getElementById('widget-form');
    
    // Atualizar elementos do preview
    document.getElementById('preview-name').textContent = 
        document.getElementById('widget-name').value || 'Nome do Widget';
    
    document.getElementById('preview-symbol').textContent = 
        document.getElementById('token-symbol').value || 'XYZ';
    
    document.getElementById('preview-description').textContent = 
        document.getElementById('widget-description').value || 'Descri√ß√£o aparecer√° aqui...';
    
    const price = document.getElementById('token-price').value;
    document.getElementById('preview-price').textContent = 
        price ? `${price} BNB` : '0.001 BNB';
    
    const supply = document.getElementById('total-supply').value;
    document.getElementById('preview-supply').textContent = 
        supply ? Number(supply).toLocaleString() : '1,000,000';
    
    // Atualizar cor do preview
    const color = document.getElementById('widget-color').value;
    const previewCard = document.getElementById('widget-preview');
    const buyButton = previewCard.querySelector('.btn-primary');
    
    if (buyButton) {
        buyButton.style.backgroundColor = color;
        buyButton.style.borderColor = color;
    }
    
    // Atualizar √≠cone baseado no estilo
    const style = document.getElementById('widget-style').value;
    const icon = document.getElementById('preview-icon');
    
    const styleIcons = {
        'modern': 'fas fa-cube',
        'classic': 'fas fa-coins',
        'minimal': 'fas fa-circle',
        'gradient': 'fas fa-gem'
    };
    
    if (icon) {
        icon.className = `${styleIcons[style] || 'fas fa-cube'} fa-3x text-primary mb-3`;
    }
}

// Visualizar widget em modal
function previewWidget() {
    const name = document.getElementById('widget-name').value;
    const symbol = document.getElementById('token-symbol').value;
    const price = document.getElementById('token-price').value;
    
    if (!name || !symbol || !price) {
        alert('Por favor, preencha os campos obrigat√≥rios (Nome, S√≠mbolo e Pre√ßo)');
        return;
    }
    
    // Criar modal de preview
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.innerHTML = `
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Preview do Widget - ${name}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center p-4" style="background: linear-gradient(135deg, ${document.getElementById('widget-color').value}, ${document.getElementById('widget-color').value}44);">
                        <h3 class="text-white mb-3">${name}</h3>
                        <p class="text-white mb-4">${document.getElementById('widget-description').value || 'Descri√ß√£o do projeto'}</p>
                        <div class="bg-white rounded p-4 d-inline-block">
                            <div class="row text-center">
                                <div class="col-4">
                                    <h5 class="text-primary">${symbol}</h5>
                                    <small class="text-muted">Token</small>
                                </div>
                                <div class="col-4">
                                    <h5 class="text-success">${price} BNB</h5>
                                    <small class="text-muted">Pre√ßo</small>
                                </div>
                                <div class="col-4">
                                    <h5 class="text-info">${Number(document.getElementById('total-supply').value || 1000000).toLocaleString()}</h5>
                                    <small class="text-muted">Dispon√≠vel</small>
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-8">
                                    <input type="number" class="form-control" placeholder="Quantidade" min="1">
                                </div>
                                <div class="col-4">
                                    <button class="btn btn-primary w-100" style="background-color: ${document.getElementById('widget-color').value};">
                                        Comprar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-success" onclick="createWidget()" data-bs-dismiss="modal">
                        <i class="fas fa-save me-1"></i>Criar Este Widget
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    const bsModal = new bootstrap.Modal(modal);
    bsModal.show();
    
    // Remover modal quando fechado
    modal.addEventListener('hidden.bs.modal', () => {
        modal.remove();
    });
}

// Criar widget
function createWidget() {
    const form = document.getElementById('widget-form');
    
    // Validar campos obrigat√≥rios
    const requiredFields = ['widget-name', 'token-symbol', 'token-price', 'total-supply', 'blockchain-network'];
    for (let field of requiredFields) {
        if (!document.getElementById(field).value) {
            alert(`Campo obrigat√≥rio: ${document.querySelector(`label[for="${field}"]`).textContent}`);
            return;
        }
    }
    
    // Simular cria√ß√£o do widget
    const widgetData = {
        id: 'widget_' + Date.now(),
        name: document.getElementById('widget-name').value,
        symbol: document.getElementById('token-symbol').value,
        description: document.getElementById('widget-description').value,
        price: parseFloat(document.getElementById('token-price').value),
        minPurchase: parseInt(document.getElementById('min-purchase').value) || 1,
        maxPurchase: parseInt(document.getElementById('max-purchase').value) || null,
        totalSupply: parseInt(document.getElementById('total-supply').value),
        color: document.getElementById('widget-color').value,
        style: document.getElementById('widget-style').value,
        network: document.getElementById('blockchain-network').value,
        contract: document.getElementById('token-contract').value,
        createdAt: new Date().toISOString(),
        status: 'active'
    };
    
    // Salvar no localStorage (simula√ß√£o)
    let widgets = JSON.parse(localStorage.getItem('widgets') || '[]');
    widgets.push(widgetData);
    localStorage.setItem('widgets', JSON.stringify(widgets));
    
    // Mostrar sucesso
    const alert = document.createElement('div');
    alert.className = 'alert alert-success alert-dismissible fade show position-fixed';
    alert.style.cssText = 'top: 20px; right: 20px; z-index: 9999;';
    alert.innerHTML = `
        <i class="fas fa-check-circle me-2"></i>
        Widget "${widgetData.name}" criado com sucesso!
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    document.body.appendChild(alert);
    
    setTimeout(() => {
        alert.remove();
        loadSection('widgets');
        updateActiveMenu('widgets');
    }, 2000);
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Atualizar preview quando campos mudarem
    const formFields = document.querySelectorAll('#widget-form input, #widget-form select, #widget-form textarea');
    formFields.forEach(field => {
        field.addEventListener('input', updatePreview);
        field.addEventListener('change', updatePreview);
    });
    
    // Submit do formul√°rio
    document.getElementById('widget-form').addEventListener('submit', function(e) {
        e.preventDefault();
        createWidget();
    });
    
    // Carregar preview inicial
    updatePreview();
});

// Fun√ß√£o para resetar formul√°rio
function resetForm() {
    document.getElementById('widget-form').reset();
    updatePreview();
}

console.log('üîç Ethers.js dispon√≠vel:', typeof ethers !== 'undefined');
console.log('ü¶ä MetaMask dispon√≠vel:', typeof window.ethereum !== 'undefined');
</script>

<!-- Carregar script externo -->
<script src="../../js/modules/new-widget-manager.js"></script>
